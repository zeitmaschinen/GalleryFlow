#!/usr/bin/env python3\n\"\"\"\nSimple database migration script for adding performance fields.\nThis can be run safely on existing databases.\n\"\"\"\n\nimport sqlite3\nimport os\nfrom pathlib import Path\n\ndef migrate_database(db_path: str = \"galleryflow.db\"):\n    \"\"\"Add performance fields to existing database if they don't exist.\"\"\"\n    \n    if not os.path.exists(db_path):\n        print(f\"Database {db_path} not found. It will be created automatically when you start the application.\")\n        return\n    \n    conn = sqlite3.connect(db_path)\n    cursor = conn.cursor()\n    \n    try:\n        # Check if new columns already exist\n        cursor.execute(\"PRAGMA table_info(images)\")\n        columns = [column[1] for column in cursor.fetchall()]\n        \n        new_columns = {\n            'width': 'INTEGER',\n            'height': 'INTEGER', \n            'file_size': 'INTEGER',\n            'thumbnail_path': 'TEXT',\n            'has_thumbnail': 'BOOLEAN DEFAULT 0'\n        }\n        \n        for column_name, column_type in new_columns.items():\n            if column_name not in columns:\n                print(f\"Adding column: {column_name}\")\n                cursor.execute(f\"ALTER TABLE images ADD COLUMN {column_name} {column_type}\")\n            else:\n                print(f\"Column {column_name} already exists\")\n        \n        # Create new indices if they don't exist\n        indices = {\n            'idx_image_folder_modified': 'CREATE INDEX IF NOT EXISTS idx_image_folder_modified ON images (folder_id, last_modified)',\n            'idx_image_has_thumbnail': 'CREATE INDEX IF NOT EXISTS idx_image_has_thumbnail ON images (has_thumbnail)'\n        }\n        \n        for index_name, sql in indices.items():\n            print(f\"Creating index: {index_name}\")\n            cursor.execute(sql)\n        \n        conn.commit()\n        print(\"✅ Database migration completed successfully!\")\n        \n    except Exception as e:\n        print(f\"❌ Error during migration: {e}\")\n        conn.rollback()\n    finally:\n        conn.close()\n\nif __name__ == \"__main__\":\n    # Look for database in current directory\n    db_path = Path(\"galleryflow.db\")\n    if not db_path.exists():\n        # Try in parent directory (if running from backend/app)\n        db_path = Path(\"../../galleryflow.db\")\n    \n    migrate_database(str(db_path))\n